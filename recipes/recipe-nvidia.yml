---
# Schema validation for BlueBuild recipes
# yaml-language-server: $schema=https://schema.blue-build.org/recipe-v1.json

name: kinoite-nvidia-fusion
description: "Customized Fedora Kinoite image with proprietary Nvidia drivers and CUDA support"

# Base image with Nvidia drivers pre-installed by Universal Blue
# base-image: ghcr.io/ublue-os/kinoite-nvidia
base-image: ghcr.io/ublue-os/kinoite-nvidia
image-version: latest

modules:
  # Inherits all shared system configurations (packages, flatpaks, kargs, etc.)
  - from-file: recipe-common.yml

  # NVIDIA container toolkit for CUDA/LLM workloads in Podman/Distrobox
  - type: dnf
    install:
      packages:
        - akmod-nvidia
        - xorg-x11-drv-nvidia-cuda

  # Specific Kernel Arguments for Nvidia hardware
  - type: kargs
    kargs:
      - rd.driver.blacklist=nouveau,nova_core
      - modprobe.blacklist=nouveau,nova_core

  # Executar o script de build e assinatura
  - type: script
    scripts:
      - scripts/nvidia/nvidia-sign.sh

  # Digital signing module for image integrity and verified updates
  - type: signing
