---
# Schema validation for BlueBuild recipes
# yaml-language-server: $schema=https://schema.blue-build.org/recipe-v1.json

name: kinoite-nvidia
description: "Customized Fedora Kinoite image with proprietary Nvidia drivers and CUDA support"

# Base Fedora Kinoite + camada NVIDIA via RPM Fusion nesta receita
base-image: quay.io/fedora/fedora-kinoite
image-version: latest

modules:
  # Inherits all shared system configurations (packages, flatpaks, kargs, etc.)
  - from-file: common.yml

  # NVIDIA container toolkit for CUDA/LLM workloads in Podman/Distrobox
  - type: dnf
    install:
      packages:
        - akmod-nvidia
        - xorg-x11-drv-nvidia-cuda
        - nvidia-container-toolkit
        - mokutil

  # Specific Kernel Arguments for Nvidia hardware
  - type: kargs
    kargs:
      - rd.driver.blacklist=nouveau,nova_core
      - modprobe.blacklist=nouveau,nova_core

  # Executar o script de build e assinatura
  - type: script
    scripts:
      - scripts/nvidia/nvidia-sign.sh

  # Helper para importar chave MOK no host e habilitar NVIDIA com Secure Boot
  - type: files
    files:
      - source: scripts/nvidia/nvidia-setup.sh
        destination: /usr/bin/kinoite-setup-nvidia-secureboot.sh

  # Digital signing module for image integrity and verified updates
  - type: signing
